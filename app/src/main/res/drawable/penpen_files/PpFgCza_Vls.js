if (self.CavalryLogger) { CavalryLogger.start_js(["egiuQ"]); }

__d("FaceboxSourceConstants",[],(function(a,b,c,d,e,f){e.exports={SNOWLIFT_SUGGEST:"snowlift_suggest",SNOWLIFT_DISMISS:"photo_snowlift_unit_suggestions",PERMALINK_SUGGEST:"permalink_suggest",PERMALINK_DISMISS:"photo_permalink_suggestions",UPLOADER_SUGGEST:"uploader_suggest",UPLOADER_DISMISS:"album_uploader_suggestions"}}),null);
__d("LegacyMentionsInput.react",["cx","FocusListener","Bootloader","Event","Keys","React","ReactDOM","TypeaheadMetricsConfig"],(function(a,b,c,d,e,f,g){__p&&__p();var h;b("FocusListener");c=b("React").PropTypes;d=babelHelpers.inherits(a,b("React").Component);h=d&&d.prototype;function a(){__p&&__p();var a,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return c=(a=h.constructor).call.apply(a,[this].concat(e)),this.hasEnteredText=function(){return!!(this.$2&&this.$2.getValue().trim())}.bind(this),this.submitComment=function(event){__p&&__p();var a;if(event)a=event.target.value&&event.target.value.trim();else{var c=b("ReactDOM").findDOMNode(this.refs.textarea);c.value&&c.value!==c.placeholder&&(a=c.value)}a=a||"";c={visibleValue:a,encodedValue:a};this.$2&&(c.encodedValue=this.$2.getRawValue().trim());c=this.props.onEnterSubmit(c,event);c&&this.$2&&(this.$2.reset(),event&&event.preventDefault())}.bind(this),this.$3=function(event){var a=event.nativeEvent;a=b("Event").getKeyCode(a)==b("Keys").RETURN&&!b("Event").$E(a).getModifiers().any;var c=this.$2&&this.$2.getTypeahead().getView().getSelection();this.props.onEnterSubmit&&a&&!c&&this.submitComment(event)}.bind(this),this.$4=function(){this.props.onFocus&&this.props.onFocus(),this.$1(b("ReactDOM").findDOMNode(this.refs.root))}.bind(this),this.$5=function(){this.props.onBlur&&this.props.onBlur()}.bind(this),this.$1=function(a){__p&&__p();if(this.props.disableInitTextarea||this.$2||this.$6)return;this.$6=!0;b("Bootloader").loadModules(["CompactTypeaheadRenderer","ContextualTypeaheadView","InputSelection","MentionsInput","TextAreaControl","Typeahead","TypeaheadAreaCore","TypeaheadBestName","TypeaheadHoistFriends","TypeaheadMetrics","TypeaheadMetricsX","TypingDetector","UFIComments"],function(c,d,e,f,g,h,i,j,k,l,m,n,o){__p&&__p();o=b("ReactDOM").findDOMNode(this.refs.textarea);new g(o);if(this.props.onTypingStateChange){g=new n(o);g.init();g.subscribe("change",this.props.onTypingStateChange)}n={autoSelect:!0,renderer:c,causalElement:o,autoflip:this.props.autoflip};this.props.viewOptionsTypeObjects&&(n.typeObjects=this.props.viewOptionsTypeObjects);this.props.viewOptionsTypeObjectsOrder&&(n.typeObjectsOrder=this.props.viewOptionsTypeObjectsOrder);g=new h(this.props.datasource,{ctor:d,options:n},{ctor:i},b("ReactDOM").findDOMNode(this.refs.typeahead));c=[j,k];if(b("TypeaheadMetricsConfig").gkResults){d=new m({extraData:{event_name:"mention_metric_x"}});d.init(g)}n=new l({extraData:{event_name:"mentions",from_location:"comments"}});h.initNow(g,c,n);this.$2=new f(a,g,o,{hashtags:this.props.hashtags});this.$2.init({},this.props.initialData);this.props.initialData&&e.set(o,o.value.length);this.props.onPaste&&b("Event").listen(o,"paste",this.props.onPaste);this.props.onContentChange&&(this.$7=this.$2.subscribe("valueUpdate",function(a,b){a=b.value;this.props.onContentChange(a)}.bind(this)));this.$6=!1}.bind(this),"LegacyMentionsInput.react")}.bind(this),this.focus=function(){try{b("ReactDOM").findDOMNode(this.refs.textarea).focus()}catch(a){}}.bind(this),c}a.prototype.componentDidMount=function(){"use strict";this.props.initialData&&this.$1(b("ReactDOM").findDOMNode(this))};a.prototype.getText=function(){"use strict";return this.$2&&this.$2.getRawValue().trim()};a.prototype.componentWillUnmount=function(){"use strict";this.$2&&this.$7&&this.$2.unsubscribe(this.$7)};a.prototype.render=function(){"use strict";var a="textInput mentionsTextarea uiTextareaAutogrow uiTextareaNoResize UFIAddCommentInput _2xww";return b("React").createElement("div",{ref:"root",className:"uiMentionsInput textBoxContainer ReactLegacyMentionsInput _2xwx"},b("React").createElement("div",{className:"highlighter"},b("React").createElement("div",null,b("React").createElement("span",{className:"highlighterContent hidden_elem"}))),b("React").createElement("div",{ref:"typeahead",className:"uiTypeahead mentionsTypeahead"},b("React").createElement("div",{className:"wrap"},b("React").createElement("input",{type:"hidden",autoComplete:"off",className:"hiddenInput"}),b("React").createElement("div",{className:"innerWrap"},b("React").createElement("textarea",{ref:"textarea",name:"add_comment_text",className:a,title:this.props.placeholder,placeholder:this.props.placeholder,onFocus:this.$4,onBlur:this.$5,onKeyDown:this.$3})))),b("React").createElement("input",{type:"hidden",autoComplete:"off",className:"mentionsHidden",defaultValue:""}))};a.propTypes={initialData:c.object,disableInitTextarea:c.bool,placeholder:c.string,datasource:c.object,ref:c.string,viewOptionsTypeObjects:c.object,viewOptionsTypeObjectsOrder:c.array,hashtags:c.bool,autoflip:c.bool,onEnterSubmit:c.func,onFocus:c.func,onBlur:c.func,onContentChange:c.func,onTypingStateChange:c.func,onPaste:c.func};e.exports=a}),null);
__d("Overlay",["CSS","DataStore","DOM","Layer","LayerButtons","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerFormHooks","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerMouseHooks","LayerTabIsolation"],(function(a,b,c,d,e,f){__p&&__p();var g;c=babelHelpers.inherits(a,b("Layer"));g=c&&c.prototype;function a(a,b){"use strict";a=babelHelpers["extends"]({buildWrapper:!0},a),g.constructor.call(this,a,b)}a.prototype._configure=function(a,c){"use strict";__p&&__p();this._shouldBuildWrapper=a.buildWrapper;g._configure.call(this,a,c);a=this.getRoot();if(!a)return this;this._overlay=b("DOM").scry(a,"div.uiOverlay")[0]||a;b("CSS").hide(a);b("DOM").appendContent(this.getInsertParent(),a);b("DataStore").set(this._overlay,"overlay",this);c=b("DataStore").get(this._overlay,"width");c&&this.setWidth(c);this.setFixed&&this.setFixed(b("DataStore").get(this._overlay,"fixed")=="true");b("DataStore").get(this._overlay,"fadeonshow")!="false"&&this.enableBehavior(b("LayerFadeOnShow"));b("DataStore").get(this._overlay,"fadeonhide")!="false"&&this.enableBehavior(b("LayerFadeOnHide"));b("DataStore").get(this._overlay,"hideonsuccess")!="false"&&this.enableBehavior(b("LayerHideOnSuccess"));b("DataStore").get(this._overlay,"hideonblur")=="true"&&this.enableBehavior(b("LayerHideOnBlur"));b("DataStore").get(this._overlay,"destroyonhide")!="false"&&this.enableBehavior(b("LayerDestroyOnHide"));return this};a.prototype._getDefaultBehaviors=function(){"use strict";return g._getDefaultBehaviors.call(this).concat([b("LayerButtons"),b("LayerFormHooks"),b("LayerMouseHooks"),b("LayerHideOnEscape"),b("LayerHideOnTransition"),b("LayerTabIsolation")])};a.prototype.initWithoutBuildingWrapper=function(){"use strict";this._shouldBuildWrapper=!1;return this.init.apply(this,arguments)};a.prototype._buildWrapper=function(a,c){"use strict";if(!this._shouldBuildWrapper){this._contentRoot=c;return c}this._contentRoot=b("DOM").create("div",{className:"uiOverlayContent"},c);return b("DOM").create("div",{className:"uiOverlay"},this._contentRoot)};a.prototype.getContentRoot=function(){"use strict";return this._contentRoot};a.prototype.destroy=function(){"use strict";b("DataStore").remove(this.getRoot(),"overlay"),g.destroy.call(this)};e.exports=a}),null);
__d("PhotoAlbumAudienceInput",["Arbiter","CSS","DOM","Event"],(function(a,b,c,d,e,f){__p&&__p();function a(a,c,d,e,f){"use strict";this.$1=a,c&&(this.$2=c,this.$3=d,this.$4=e,this.$5=f,b("Arbiter").subscribe("Tokenizer/init",this.$6.bind(this)),b("Event").listen(this.$4,"click",this.$7.bind(this)))}a.prototype.removeHiddenPrivacyWidget=function(){"use strict";[this.$1,this.$2,this.$5].forEach(function(a){a&&b("CSS").hasClass(a,"hidden_elem")&&b("DOM").remove(a)})};a.prototype.$7=function(){"use strict";this.$8.removeAllTokens(),this.$9(null,null)};a.prototype.$6=function(a,c){"use strict";if(this.$8||this.$3!=c.element)return;this.$8=c;this.$9(null,null);b("Arbiter").subscribe("Form/change",this.$9.bind(this))};a.prototype.$9=function(a,b){"use strict";a=this.$8.getTokens().length>0;this.$10(a)};a.prototype.$10=function(a){"use strict";b("CSS").conditionShow(this.$2,a),b("CSS").conditionShow(this.$1,!a),this.$5&&b("CSS").conditionShow(this.$5,a)};e.exports=a}),null);
__d("PhotoAlbumPlacesTypeahead",["Arbiter"],(function(a,b,c,d,e,f){__p&&__p();function g(a){"use strict";__p&&__p();if(!a)return;if(a.getCore().getHiddenValue()){var c={uid:a.getCore().getHiddenValue(),text:a.getCore().getValue()};b("Arbiter").inform("PhotoAlbumPlacesTypeahead.EXIST_PLACE",c)}a.subscribe("select",function(c,a){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.SELECTED_PLACE",a.selected)}.bind(this));a.subscribe("reset",function(){a.getCore().getHiddenValue()||b("Arbiter").inform("PhotoAlbumPlacesTypeahead.RESET_PLACE")}.bind(this));a.subscribe("focus",function(){b("Arbiter").inform("PhotoAlbumPlacesTypeahead.FOCUSED")}.bind(this));this._initialized=!0}g.prototype.init=function(a){"use strict";if(this._initialized)return;g.call(this,a)};e.exports=g}),null);
__d("PersistentAlbumDataStore",["WebStorage"],(function(a,b,c,d,e,f){__p&&__p();var g="fb_album_recovery",h=7*60*60*24,i={_storageExists:!0,_initializeWebStorage:function(){var a=b("WebStorage").getLocalStorage();if(!a){i._storageExists=!1;return}a.getItem(g)||a.setItem(g,JSON.stringify({}))},_getAlbumsObject:function(){if(!i._storageExists)return{};i._initializeWebStorage();return JSON.parse(b("WebStorage").getLocalStorage().getItem(g))},_setAlbumsObject:function(a){if(!i._storageExists)return;i._initializeWebStorage();b("WebStorage").getLocalStorage().setItem(g,JSON.stringify(a))},_getLocalStorageByAlbum:function(a){return i._getAlbumsObject()[a]||i.createAlbum(a)},_setLocalStorageByAlbum:function(a,b){var c=i._getAlbumsObject();c[a]=b;i._setAlbumsObject(c)},createAlbum:function(a){var b={privacy:null,tags:{},created_at:Date.now()};i._setLocalStorageByAlbum(a,b);return b},deleteAlbum:function(a){var b=i._getAlbumsObject();delete b[a];i._setAlbumsObject(b)},getAlbumPrivacy:function(a){return i._getLocalStorageByAlbum(a).privacy},setAlbumPrivacy:function(a,b){var c=i._getLocalStorageByAlbum(a);c.privacy=b;i._setLocalStorageByAlbum(a,c)},saveTag:function(a,b,c){var d=i._getLocalStorageByAlbum(a);d.tags[b]||(d.tags[b]=[]);c.recovered=!0;d.tags[b].push(c);i._setLocalStorageByAlbum(a,d)},removeTag:function(a,b,c){var d=i._getLocalStorageByAlbum(a),e=d.tags[b]||[];for(var f=0;f<e.length;f++)if(e[f].subject===c||e[f].name===c){e.splice(f,1);break}d.tags[b]=e;i._setLocalStorageByAlbum(a,d)},getTags:function(a,b){return i._getLocalStorageByAlbum(a).tags[b]||[]},deleteExpiredAlbums:function(){var a=i._getAlbumsObject();for(var b in a){var c=a[b];Date.now()-c.created_at>h*1e3&&i.deleteAlbum(b)}}};e.exports=i}),null);
__d("XFamilyBulkTagAddAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/family/bulk_tag_save/",{subject:{type:"Int"},save_tags:{type:"String"}})}),null);
__d("PhotoTagStore",["AsyncRequest","XFamilyBulkTagAddAsyncController","isEmpty"],(function(a,b,c,d,e,f){__p&&__p();function g(){"use strict";this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={},g.instance=this}g.prototype.getPhotoTags=function(a){"use strict";return this._tagList[a]||{}};g.prototype.photoHasTags=function(a){"use strict";return!b("isEmpty")(this.getPhotoTags(a))};g.prototype.clear=function(){"use strict";this._tagList={},this._textTagList={},this._originalTagList={},this._dirtyPhotosByUid={}};g.prototype.addTag=function(a,b,c,d){"use strict";a[b]=a[b]||{};var e=a[b][c]||[];e.push(d);a[b][c]=e};g.prototype.revert=function(a){"use strict";var c=this._tagList,d=this._originalTagList;for(var e in c)b("isEmpty")(d[e][a])?c[e][a]=[]:c[e][a]=d[e][a];this._dirtyPhotosByUid={}};g.prototype.hasNewTags=function(){"use strict";return!b("isEmpty")(this._tagList)||!b("isEmpty")(this._textTagList)};g.prototype.userHasDirtyTags=function(a){"use strict";return!b("isEmpty")(this._dirtyPhotosByUid[a])};g.prototype.userDirtyTagsCount=function(a){"use strict";return Object.keys(this._dirtyPhotosByUid[a]).length};g.prototype.handleTagFetch=function(a){"use strict";for(var b in a)this.loadTagInfo(b,a[b])};g.prototype.saveAlbumTagsForUser=function(a,c,d,e){__p&&__p();e===void 0&&(e=!1);var f={},g=[],h=this._dirtyPhotosByUid[a]||{};for(var i in h){h=this._tagList[i][a];if(b("isEmpty")(h)){g[g.length]=i;continue}h.forEach(function(a){f[i]={x:a.x,y:a.y}})}h={subject:a,user:c,action:"save",save_tags:f};g="/ajax/photos/album/tags.php";e&&(h={subject:a,save_tags:JSON.stringify(f)},g=b("XFamilyBulkTagAddAsyncController").getURIBuilder().getURI());new(b("AsyncRequest"))().setURI(g).setData(h).setHandler(function(a){d(a.payload)}).setAllowCrossPageTransition(!0).send();delete this._dirtyPhotosByUid[a]};g.prototype.getTagsFromList=function(a){"use strict";var b=[];for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c))for(var d in a[c])Object.prototype.hasOwnProperty.call(a[c],d)&&a[c][d].forEach(function(a){return b.push(a)});return b};g.prototype.getAllTags=function(){"use strict";var a=this.getTagsFromList(this._tagList),b=this.getTagsFromList(this._textTagList);return a.concat(b)};g.prototype.removeTag=function(a,c){"use strict";__p&&__p();var d=this._tagList[a],e=this._originalTagList[a]||{};e[c]?(this._dirtyPhotosByUid[c]=this._dirtyPhotosByUid[c]||{},this._dirtyPhotosByUid[c][a]=!0):delete this._dirtyPhotosByUid[c][a];for(var f in d)if(f==c){e=this._tagList[a][f];delete this._tagList[a][f];b("isEmpty")(this._tagList[a])&&delete this._tagList[a];return e}};g.prototype.removeTextTag=function(a,c){"use strict";var d=this._textTagList[a];if(!b("isEmpty")(d[c])){d=this._textTagList[a][c];this._textTagList[a][c]=[];b("isEmpty")(this._textTagList[a])&&delete this._textTagList[a];return d}return[]};g.prototype.removeAllNewTagsOfUser=function(a){"use strict";var b=[];if(!this.userHasDirtyTags(a))return b;var c=this._dirtyPhotosByUid[a];for(var d in c)b=b.concat(this.removeTag(d,a));return b};g.prototype.removeAllTagsFromPhoto=function(a){"use strict";__p&&__p();var c=[];if(!b("isEmpty")(this._tagList[a]))for(var d in this._tagList[a]){if(!Object.prototype.hasOwnProperty.call(this._tagList[a],d))continue;c=c.concat(this.removeTag(a,d))}if(!b("isEmpty")(this._textTagList[a]))for(var e in this._textTagList[a]){if(!Object.prototype.hasOwnProperty.call(this._textTagList[a],e))continue;c=c.concat(this.removeTextTag(a,e))}return c};g.prototype.storeTag=function(a,b,c,d,e){"use strict";this.storeTagWithOptions(a,b,c,d,{can_remove:e})};g.prototype.storeTagWithOptions=function(a,b,c,d,e){"use strict";this._dirtyPhotosByUid[b]=this._dirtyPhotosByUid[b]||{};this._dirtyPhotosByUid[b][a]=!0;c={x:c,y:d};Object.assign(c,e);!b?this.addTag(this._textTagList,a,c.name,c):this.addTag(this._tagList,a,b,c)};g.prototype.loadTagInfo=function(a,b){"use strict";this._tagList[a]={};this._originalTagList[a]={};for(var c=0;c<b.length;c++){var d=b[c];this.addTag(this._tagList,a,d.subject,d);this.addTag(this._originalTagList,a,d.subject,d)}};g.getInstance=function(){"use strict";g.instance===null&&new g();return g.instance};g.instance=null;e.exports=g}),null);
__d("PhotoTagDataSourceType",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({PRODUCT_ITEMS:"product_items",DEFAULT:"default"})}),null);
__d("PhotosTaggingWaterfall",["AsyncSignal"],(function(a,b,c,d,e,f){function g(a){g._queueName=a||g._queueName}Object.assign(g,{BEGIN:"begin",TAG_FACE:"tag_face",HOVER_TAG_FACE:"hover_tag_face",SHOW_SUGGEST:"show_suggest",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:"type_name",SELECT_NAME:"select_name",_queueName:null,sendSignal:function(a,c){new(b("AsyncSignal"))("/ajax/photos/tag_waterfall.php",{data:JSON.stringify(a)}).setHandler(c).send()}});e.exports=g}),null);
__d("PhotoTagger",["csx","ActorURI","Arbiter","AsyncRequest","AsyncResponse","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Hovercard","Keys","LegacyMentionsInput.react","Parent","PhotosConst","PhotosTaggingWaterfall","PhotosUtils","PhotoTagDataSourceType","PhotoTagStore","QE2Logger","React","ReactDOM","Style","UFIAddCommentController","UFICentralUpdates","UFIComment.react","UFIContainer.react","URI","Vector","WWWBase","getElementPosition","removeFromArray"],(function(a,b,c,d,e,f,g){__p&&__p();function h(a,b){return(a%b+b)%b}function i(a){"use strict";this.TAG_BOX_SIZE=100,this.EPSILON=.0025,this.HUGE_FACE_THRESH=90,this.HUGE_FACE_SHRINK_FACTOR=.6,this.elemNames={6:{addTagLink:"div.fbPhotosPhotoOwnerButtons",overlayActions:"div.snowliftOverlayBar"}},this.viewer=a,this.version=a.getVersionConst(),this.datasources={},this.photoData={},this.tagRects={},this.spatialTags=[],this.isSpherical=!1,this.sphericalPhotoXY=null,this.fromSphericalFacebox=!1,this.disableSaveSpatialTag=!1,this.ajaxURIs={tagsInit:"/ajax/photos/photo/tags/tags_init.php",tagsAlbum:"/ajax/photos/photo/tags/tags_album.php",fetchDatasource:"/ajax/photos/photo/tags/fetch_datasource.php",tagAction:"/ajax/photo_tagging_ajax.php",tagWithAction:"/ajax/with_tagging_ajax.php"},this.recognizedUsers=[],this.addedSuggestions=[],this.featuredSuggestions=[],this.albumSuggestions=[],this.friendSuggestions=[],this.suggestionAlbum=-1,this.addCommentController=null,i.instances[this.version]=this}i.prototype.initSnowlift=function(a,c,d,e){"use strict";this._init(a,c,d,this.viewer.container,e),b("Arbiter").inform("PhotoSnowlift.TAGGER_READY")};i.prototype.initPermalink=function(a,b,c){"use strict";this._init(a,b,c,this.viewer.actionList)};i.prototype.initSphericalPhoto=function(a,c,d){"use strict";this._init(a,c,d,this.viewer.container),b("Arbiter").inform("PhotoTagger.SPATIAL_TAGGER_READY")};i.prototype._init=function(a,c,d,e,f){"use strict";__p&&__p();this.root=this.viewer.getRoot();this.tagger=a;this.tokenizer=c;this.ufi=f;this._qn=null;this.typeahead=c.getTypeahead();this.userId=d;this.makeProfilePicMenuContainer=e;this.faceboxes=[];this.tags=[];this.currentFacebox=null;this.currentTextbox=null;this.revokedFaceboxes=[];this.requestFaceboxNextTag=!1;this.clickState=b("DOM").find(this.root,"div.stageActions");this.newTagBox=b("DOM").find(this.clickState,"div.newTagBox");this.addTagLink=null;this.overlayActions=null;this.elemNames[this.version]&&(this.addTagLink=b("DOM").find(this.root,this.elemNames[this.version].addTagLink),this.overlayActions=b("DOM").find(this.root,this.elemNames[this.version].overlayActions));this.setupHandlers();this.hideNewTagTimer=null;this.needAlbumSuggestionsFetch=!0;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());this.updateFaceboxes();this.tagAccumulating=!1;return this};i.prototype.setTagAccumulator=function(a){"use strict";this.tagAccumulating=a};i.prototype.fetchTaggingSuggestions=function(a){"use strict";__p&&__p();var c=new(b("URI"))(b("WWWBase").uri).setPath(this.ajaxURIs.tagsInit);new(b("AsyncRequest"))().setAllowCrossPageTransition(!0).setAllowCrossOrigin(!0).setURI(c).setData(a).setOption("retries",1).setHandler(function(a){a=a.getPayload();this.featuredSuggestions=a.featuredTaggees;this.friendSuggestions=a.friendTaggees;this.updateTypeaheadSuggestions()}.bind(this)).send();var d=this.typeahead.subscribe("bootstrap",function(a,b){