if (self.CavalryLogger) { CavalryLogger.start_js(["fE\/jf"]); }

__d("ImageUtils",["UserAgent_DEPRECATED"],(function(a,b,c,d,e,f){__p&&__p();a={hasLoaded:function(a){__p&&__p();if(a.naturalWidth!==undefined)return a.complete&&a.width!==0;else if(a.height==20&&a.width==20&&a.complete)return!1;else if(a.complete===undefined&&b("UserAgent_DEPRECATED").webkit()<500){var c=new Image();c.src=a.src;return c.complete}return a.complete}};e.exports=a}),null);
__d("PhotoEverstoreLogger",["AsyncRequest","Event","ImageUtils"],(function(a,b,c,d,e,f){__p&&__p();var g={BATCH_WINDOW_MS:500,storedLog:[]};function h(){}Object.assign(h,{_log:function(a){g.storedLog.push(a),g.storedLog.length==1&&setTimeout(i,g.BATCH_WINDOW_MS)},logImmediately:function(a){h._log(a)},registerForLogging:function(a){var c=document.getElementById(a);c!=null&&(b("ImageUtils").hasLoaded(c)?h._log(c.src):b("Event").listen(c,"load",function(event){h._log(c.src)}))}});function i(){var a=g.storedLog;g.storedLog=[];a=JSON.stringify(a);new(b("AsyncRequest"))().setURI("/ajax/photos/logging/everstore_logging.php").setData({loggedUrls:a}).setMethod("POST").setOption("suppressErrorHandlerWarning",!0).setOption("suppressErrorAlerts",!0).send()}e.exports=h}),null);
__d("PhotoViewerImage",["PhotoEverstoreLogger","URI","Vector"],(function(a,b,c,d,e,f){__p&&__p();function g(a){"use strict";this._hiResDimensions=a.hiResDimensions&&b("Vector").deserialize(a.hiResDimensions),this._normalDimensions=a.normalDimensions&&b("Vector").deserialize(a.normalDimensions),this._info=a.info,this._video=a.video,this._shouldLog=a.everstoreLogThis,this._hiResSrc=a.hiResSrc,this._normalSrc=a.normalSrc,this._thumbSrc=a.thumbSrc,this._isInverted=!1,this._data=a}g.prototype.getURIString=function(){"use strict";return new(b("URI"))(this._info.permalink).getUnqualifiedURI().toString()};g.prototype.hasHiResDimensions=function(){"use strict";return!!this._hiResDimensions};g.prototype.getHiResDimensions=function(){"use strict";return this._hiResDimensions};g.prototype.getNormalDimensions=function(){"use strict";return this._normalDimensions};g.prototype.getHiResSrc=function(){"use strict";return this._hiResSrc};g.prototype.getNormalSrc=function(){"use strict";return this._normalSrc};g.prototype.getThumbSrc=function(){"use strict";return this._thumbSrc};g.prototype.getInfo=function(){"use strict";return this._info};g.prototype.getPermalink=function(){"use strict";return this._info.permalink};g.prototype.getHighestResSrc=function(){"use strict";return this._hiResSrc||this._normalSrc};g.prototype.preload=function(a){"use strict";var c;this.getHighestResSrc()&&(a&&!this._resource?(this._resource=new Image(),this._resource.src=this.getHighestResSrc(),c=this._resource.src,this._shouldLog&&b("PhotoEverstoreLogger").logImmediately(this._resource.src)):!a&&!this._small&&(this._small=new Image(),this._small.src=this._normalSrc||this._hiResSrc,c=this._small.src,this._shouldLog&&b("PhotoEverstoreLogger").logImmediately(this._small.src)));return c};g.prototype.setNormalDimensions=function(a,c){"use strict";this._normalDimensions=new(b("Vector"))(a,c)};g.prototype.setHiResDimensions=function(a,c){"use strict";this._hiResDimensions=new(b("Vector"))(a,c)};g.prototype.invertDimensions=function(){"use strict";this.hasHiResDimensions()&&(this._hiResDimensions=new(b("Vector"))(this._hiResDimensions.y,this._hiResDimensions.x)),this._normalDimensions=new(b("Vector"))(this._normalDimensions.y,this._normalDimensions.x),this._isInverted=!this._isInverted};g.prototype.copy=function(){"use strict";return new g(this._data)};e.exports=g}),null);
__d("PhotosConst",[],(function(a,b,c,d,e,f){a={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,VIEWER_SNOWFLAKE:14,VIEWER_COMPOSER:16,VIEWER_CAROUSEL:19,VIEWER_SPHERICAL:20,VIEWER_PERMALINK_STRING:"permalink",VIEWER_SNOWLIFT_STRING:"snowlift",VIEWER_VAULTBOX_STRING:"vaultbox",VIEWER_CAROUSEL_STRING:"carousel",BULK_EDITOR:3,BULK_EDITOR_REACT:15,EDITOR_MODAL:17,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:"n",PIC_NORMAL_FBX_SIZE:180,ALBUM_NAME_MAXLEN:65};e.exports=a}),null);
__d("PhotoStreamCache",["DOM","HTML","PhotoEverstoreLogger","PhotosConst","PhotoViewerImage","Rect","UIPagelet","URI","Vector","ge"],(function(a,b,c,d,e,f){__p&&__p();g.prototype.init=function(a,b,c,d,e){"use strict";this.version=a,this.pageletName=b,this.pageletRootID=c,this.tagSuggestionMode=e,this.bufferSize=g.BUFFER_SIZE,this.fullBucketSize=g.FULL_BUCKET_SIZE,this.initError=!1,this.isActive=!0,this.usesOpaqueCursor=!1,this.usesNonCircularPhotoSet=!1,this.reachedLeftEnd=!1,this.reachedRightEnd=!1,this.leftLock=!1,this.rightLock=!1,this.useAjaxPipe=!0,this.logger=d,this.viewAsUser=null,this.reset()};g.prototype.setViewAs=function(a){"use strict";this.viewAsUser=a};g.prototype.isInViewAsMode=function(){"use strict";return!!this.viewAsUser};g.prototype.getViewAsUserId=function(){"use strict";return this.viewAsUser};g.prototype.getUsesOpaqueCursor=function(){"use strict";return this.usesOpaqueCursor};g.prototype.isNonCircularPhotoSet=function(){"use strict";return this.usesNonCircularPhotoSet};g.prototype.setReachedLeftEnd=function(){"use strict";this.reachedLeftEnd=!0};g.prototype.setReachedRightEnd=function(){"use strict";this.reachedRightEnd=!0};g.prototype.hasReachedLeftEnd=function(){"use strict";return this.reachedLeftEnd};g.prototype.hasReachedRightEnd=function(){"use strict";return this.reachedRightEnd};g.prototype.nonCircularPhotoSetCanPage=function(a){"use strict";if(!this.isNonCircularPhotoSet())return!0;if(a<0)return this.getCursorPos()||!this.hasReachedLeftEnd();return a>0?this.getLength()-1!=this.getCursorPos()||!this.hasReachedRightEnd():!0};g.prototype.setUseAjaxPipe=function(a){"use strict";this.useAjaxPipe=a};g.prototype.reset=function(){"use strict";this.cache={image:{},extra:{},html:{}},this.fbidList=[],this.loaded=!1,this.allLoaded=!1,this.permalinkMap={},this.position=0,this.totalCount=null,this.firstCursor=null,this.firstCursorIndex=null,this.firstOpaqueCursor=null};g.prototype.waitForInitData=function(){"use strict";this.fbidList.push(g.INIT_PLACEHOLDER)};g.prototype.destroy=function(){"use strict";this.reset(),this.isActive=!1};g.prototype.isLoaded=function(){"use strict";return this.loaded};g.prototype.canPage=function(){"use strict";if(!this.isLoaded())return!1;if(this.totalCount!==null)return this.totalCount>1;return this.usesNonCircularPhotoSet?!0:this.getLength()>1};g.prototype.errorInCurrent=function(){"use strict";if(this.initError)return!0;else if(!this.isLoaded())return!1;return this.checkErrorAt(this.getCursor())};g.prototype.getLength=function(){"use strict";return this.fbidList.length};g.prototype.getPhotoSet=function(){"use strict";return this.photoSetQuery.set};g.prototype.getPhotoSetQuery=function(){"use strict";return this.photoSetQuery};g.prototype.getCurrentImageData=function(){"use strict";return this.getImageData(this.getCursor())};g.prototype.getNextImageData=function(){"use strict";if(!this.fbidList||!this.fbidList.length)return null;var a=(this.position+1)%this.fbidList.length;return this.getImageData(this.getCursorAt(a))};g.prototype.getPreviousImageData=function(){"use strict";if(!this.fbidList||!this.fbidList.length)return null;var a=this.fbidList.length;a=(this.position+a-1)%a;return this.getImageData(this.getCursorAt(a))};g.prototype.addViewAsToURI=function(a){"use strict";a=new(b("URI"))(a);this.isInViewAsMode()&&a.addQueryData({viewas:this.getViewAsUserId()});return a};g.prototype.getOpaqueCursor=function(a){"use strict";if(this.getImageData(a))return this.version===b("PhotosConst").VIEWER_VAULTBOX?this.getImageData(a).getInfo().opaquecursor:this.getImageData(a).info.opaquecursor;return a==this.firstCursor?this.firstOpaqueCursor:null};g.prototype.getImageData=function(a){"use strict";a=this.getCacheContent(a,g.IMAGE_DATA);a&&(a.info.permalink=this.addViewAsToURI(a.info.permalink));return a};g.prototype.getCurrentHtml=function(){"use strict";return this.getCacheContent(this.getCursor(),g.HTML)};g.prototype.getCurrentExtraData=function(){"use strict";return this.getCacheContent(this.getCursor(),g.EXTRA)};g.prototype.getCacheContent=function(a,b){"use strict";return!a||a===g.ERROR_ID||a===g.INIT_PLACEHOLDER?null:this.cache[b][a]};g.prototype.getCursorPos=function(){"use strict";return this.position};g.prototype.getCursor=function(){"use strict";return this.position>=0&&this.position<this.getLength()?this.fbidList[this.position]:null};g.prototype.getCursorAt=function(a){"use strict";return this.fbidList[a]};g.prototype.getCursorForURI=function(a){"use strict";return this.permalinkMap[a]};g.prototype.calculatePositionForMovement=function(a){"use strict";a=this.position+a;if(this.allLoaded){var b=this.getLength();a=(b+a%b)%b}return a};g.prototype.isValidMovement=function(a){"use strict";if(!this.isLoaded()||!this.canPage())return!1;a=this.calculatePositionForMovement(a);return this.getCursor()>0||a>=0&&a<this.getLength()};g.prototype.moveCursor=function(a){"use strict";if(!this.isValidMovement(a))return;this.position=this.calculatePositionForMovement(a);a!==0&&this.loadMoreIfNeccessary(a>0)};g.prototype.checkErrorAt=function(a){"use strict";if(!this.isLoaded())return!1;return a===g.ERROR_ID?!0:!1};g.prototype.getRelativeMovement=function(a){"use strict";for(var b=0;b<this.getLength();b++)if(this.fbidList[b]==a)return b-this.position;return null};g.prototype.preloadImages=function(a){"use strict";var c,d=this.getLength(),e=this.cache.image,f=g.BUFFER_SIZE;d>f*2?(c=(this.position+d-f%d)%d,f=(this.position+f)%d):(c=0,f=d-1);while(c!=f){var h,i=this.fbidList[c],j=a&&a(e[i]);this.version===b("PhotosConst").VIEWER_VAULTBOX?h=e[i]&&e[i].preload(j):e[i]&&e[i].url&&(j&&!e[i].resource?(e[i].resource=new Image(),e[i].resource.src=e[i].url,h=e[i].url,e[i].everstoreLogThis===!0&&b("PhotoEverstoreLogger").logImmediately(e[i].resource.src)):!j&&!e[i].small&&(e[i].small=new Image(),e[i].small.src=e[i].smallurl||e[i].url,h=e[i].small.src,e[i].everstoreLogThis===!0&&b("PhotoEverstoreLogger").logImmediately(e[i].small.src)));this.logger&&h&&this.logger.log(h);c=(c+1)%d}};g.prototype.loadMoreIfNeccessary=function(a){"use strict";if(this.allLoaded||a&&this.rightLock||!a&&this.leftLock)return;a=a?1:-1;a=this.position+this.bufferSize*a;a<0&&!this.checkErrorAt(this.getEndCursor(!1))?(this.leftLock=!0,this.fetch(this.fullBucketSize,!1)):a>this.getLength()&&!this.checkErrorAt(this.getEndCursor(!0))&&(this.rightLock=!0,this.fetch(this.fullBucketSize,!0))};g.prototype.getEndCursor=function(a){"use strict";return a?this.fbidList[this.getLength()-1]:this.fbidList[0]};g.prototype.calculateRelativeIndex=function(a,b,c){"use strict";if(!this.totalCount)return null;b=this.fbidList.indexOf(b);c=this.fbidList.indexOf(c);if(b===-1||c===-1)return null;c=c-b;return(a+c+this.totalCount)%this.totalCount};g.prototype.calculateDistance=function(a,b){"use strict";a=this.fbidList.indexOf(a);b=this.fbidList.indexOf(b);return a===-1||b===-1?null:(b-a+this.getLength())%this.getLength()};g.prototype.fetch=function(a,c){"use strict";var d=this.getEndCursor(c);c=babelHelpers["extends"]({cursor:d,version:this.version,end:this.getEndCursor(!c),fetchSize:c?a:-1*a,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(d),tagSuggestionMode:this.tagSuggestionMode,is_from_groups:this.isFromGroups},this.photoSetQuery);this.isInViewAsMode()&&(c.viewas=this.getViewAsUserId());this.totalCount&&this.firstCursorIndex!==null&&(c.total=this.totalCount,c.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,d));a=b("ge")(this.pageletRootID);a||(!1,a=b("DOM").create("div",{id:this.pageletRootID}),b("DOM").appendContent(document.body,a));b("UIPagelet").loadFromEndpoint(this.pageletName,a,c,{usePipe:this.useAjaxPipe,automatic:!0,jsNonblock:!0,crossPage:!0});this.useAjaxPipe||this.setUseAjaxPipe(!0)};g.prototype.storeToCache=function(a){"use strict";__p&&__p();var b={};if(!this.isActive)return b;if("error"in a){this.processErrorResult(a.error);b.error=!0;return b}"init"in a&&(this.processInitResult(a.init),b.init={logids:a.init.logids,fbid:a.init.fbid,loggedin:a.init.loggedin,fromad:a.init.fromad,withinbusiness:a.init.withinbusiness,eid:a.init.eid});"image"in a&&(this.processImageResult(a.image),b.image=!0);"data"in a&&(this.processDataResult(a.data),b.data=!0);return b};g.prototype.processInitResult=function(a){"use strict";__p&&__p();if(this.loaded)return;this.usesOpaqueCursor=a.usesopaquecursor;this.usesNonCircularPhotoSet=a.isnoncircularphotoset;this.setIsFromGroups(a.is_from_groups);this.loaded=!0;this.photoSetQuery=a.query;a.bufferSize&&(this.bufferSize=a.bufferSize);a.fullBucketSize&&(this.fullBucketSize=a.fullBucketSize);if(this.fbidList.length===0)this.fbidList.push(a.fbid),this.rightLock=!0;else{var c=this.fbidList.indexOf(g.INIT_PLACEHOLDER);c!=-1&&(this.fbidList[c]=a.fbid)}this.firstCursor=a.fbid;this.firstOpaqueCursor=a.opaquecursor;"initIndex"in a&&"totalCount"in a&&(this.firstCursorIndex=a.initIndex,this.totalCount=a.totalCount);if(this.version==b("PhotosConst").VIEWER_PERMALINK){c=a.initialBucketSize?a.initialBucketSize:g.INIT_BUCKET_SIZE;this.fetch(c,!0)}};g.prototype.processImageResult=function(a){"use strict";__p&&__p();for(var c in a){c===this.firstCursor&&a[c].everstoreLogThis&&b("PhotoEverstoreLogger").logImmediately(a[c].url);if(this.version===b("PhotosConst").VIEWER_VAULTBOX){var d=a[c];this.cache.image[c]=new(b("PhotoViewerImage"))(d);this.permalinkMap[this.cache.image[c].getURIString()]=c}else this.cache.image[c]=a[c],a[c].dimensions&&(this.cache.image[c].dimensions=b("Vector").deserialize(a[c].dimensions)),a[c].originalDimensions&&(this.cache.image[c].originalDimensions=b("Vector").deserialize(a[c].originalDimensions)),a[c].smalldims&&(this.cache.image[c].smalldims=b("Vector").deserialize(a[c].smalldims)),this.permalinkMap[new(b("URI"))(a[c].info.permalink).getUnqualifiedURI().toString()]=c}};g.prototype.attachToFbidsList=function(a,b,c){"use strict";__p&&__p();if(this.allLoaded)return;if(this.fbidList.length===1)for(var d=0;d<a.length;d++)if(this.fbidList.indexOf(a[d])!==-1)return;if(b===-1){for(var d=a.length-1;d>=0;d--)this.fbidList.unshift(a[d]),this.position++;this.leftLock=!1}else{for(var b=0;b<a.length;b++)this.fbidList.push(a[b]);this.rightLock=!1}c&&this.setAllLoaded()};g.prototype.setAllLoaded=function(){"use strict";this.allLoaded=!0,this.getCursor()===null&&(this.position=this.calculatePositionForMovement(0))};g.prototype.processDataResult=function(a){"use strict";__p&&__p();for(var c in a){this.cache.html[c]||(this.cache.html[c]={});for(var d in a[c].html){var e=a[c].html[d];typeof e==="string"&&(e=b("HTML")(e).getRootNode());e.childNodes?this.cache.html[c][d]=Array.from(e.childNodes):this.cache.html[c][d]=[]}if(!("extra"in a[c])){this.cache.extra[c]=null;continue}this.cache.extra[c]={tagRects:{}};if(!Array.isArray(a[c].extra.tagRects))for(var f in a[c].extra.tagRects)a[c].extra.tagRects[f]&&(this.cache.extra[c].tagRects[f]=b("Rect").deserialize(a[c].extra.tagRects[f]));Object.keys(a[c].extra).forEach(function(b){if(b=="tagRects")return;this.cache.extra[c][b]=a[c].extra[b]}.bind(this))}};g.prototype.processErrorResult=function(a){"use strict";if(!this.isLoaded()){this.initError=!0;return}a=a.side;var b=[g.ERROR_ID];this.attachToFbidsList(b,a)};g.prototype.setTotalCount=function(a){"use strict";this.totalCount=a};g.prototype.setFirstCursorIndex=function(a){"use strict";this.firstCursorIndex=a};g.prototype.setIsFromGroups=function(a){"use strict";this.isFromGroups=a};function g(){"use strict"}Object.assign(g,{ERROR:"error",HTML:"html",IMAGE_DATA:"image",EXTRA:"extra",BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});e.exports=g}),null);
__d("XPhotosetSearchPivotController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/search-pivot/photoset/",{fbid:{type:"Int",required:!0},tags:{type:"IntToIntMap"}})}),null);
__d("PhotosetSearchPivotData",["Promise","AsyncRequest","PhotoStreamCache","XPhotosetSearchPivotController"],(function(a,b,c,d,e,f){__p&&__p();var g=/^(perm:)?tag:(\d+)/,h={};a={fetch:function(a,c){__p&&__p();if(!(a in h)){var d=b("XPhotosetSearchPivotController").getURIBuilder().setInt("fbid",a);if(c){var e={};c.fbidList.forEach(function(a){a=c.getCacheContent(a,b("PhotoStreamCache").EXTRA);a&&Object.keys(a.tagRects).forEach(function(a){if(g.test(a)){a=RegExp.$2;a in e?e[a]++:e[a]=1}})});d.setIntToIntMap("tags",e)}h[a]=new(b("Promise"))(function(a,c){new(b("AsyncRequest"))().setURI(d.getURI()).setHandler(function(b){a(b.getPayload())}).setErrorHandler(c).setAllowCrossPageTransition(!0).send()})}return h[a]["catch"](function(b){delete h[a];throw b})}};e.exports=a}),null);
__d("SphericalPhotoViewerTypedLogger",["Banzai","GeneratedLoggerUtils","nullthrows"],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(){this.clear()}a.prototype.log=function(){b("GeneratedLoggerUtils").log("spherical_photo_viewer_log:SphericalPhotoViewerLoggerConfig",this.$1,b("Banzai").BASIC)};a.prototype.logVital=function(){b("GeneratedLoggerUtils").log("spherical_photo_viewer_log:SphericalPhotoViewerLoggerConfig",this.$1,b("Banzai").VITAL)};a.prototype.logImmediately=function(){b("GeneratedLoggerUtils").log("spherical_photo_viewer_log:SphericalPhotoViewerLoggerConfig",this.$1,{signal:!0})};a.prototype.clear=function(){this.$1={};return this};a.prototype.getData=function(){return babelHelpers["extends"]({},this.$1)};a.prototype.updateData=function(a){this.$1=babelHelpers["extends"]({},this.$1,a);return this};a.prototype.setAvgFrameRenderTime=function(a){this.$1.avg_frame_render_time=a;return this};a.prototype.setAvgTextureToScreenRatio2=function(a){this.$1.avg_texture_to_screen_ratio2=a;return this};a.prototype.setClientUserID=function(a){this.$1.client_userid=a;return this};a.prototype.setComposerSessionID=function(a){this.$1.composer_session_id=a;return this};a.prototype.setCountry=function(a){this.$1.country=a;return this};a.prototype.setDevicePixelRatio=function(a){this.$1.device_pixel_ratio=a;return this};a.prototype.setDt=function(a){this.$1.dt=a;return this};a.prototype.setErrorCode=function(a){this.$1.error_code=a;return this};a.prototype.setErrorMessage=function(a){this.$1.error_message=a;return this};a.prototype.setErrorStackTrace=function(a){this.$1.error_stack_trace=a;return this};a.prototype.setErrorType=function(a){this.$1.error_type=a;return this};a.prototype.setEventType=function(a){this.$1.event_type=a;return this};a.prototype.setFallbackUI=function(a){this.$1.fallback_ui=a;return this};a.prototype.setIsGyroEnabled=function(a){this.$1.is_gyro_enabled=a;return this};a.prototype.setMaxGpuMemoryUsed=function(a){this.$1.max_gpu_memory_used=a;return this};a.prototype.setMaxTileLevel=function(a){this.$1.max_tile_level=a;return this};a.prototype.setName=function(a){this.$1.name=a;return this};a.prototype.setNumberOfSphericalPhoto=function(a){this.$1.number_of_spherical_photo=a;return this};a.prototype.setPhotoID=function(a){this.$1.photo_id=a;return this};a.prototype.setPitch=function(a){this.$1.pitch=a;return this};a.prototype.setRenderMethod=function(a){this.$1.render_method=a;return this};a.prototype.setSphericalPhotoSessionID=function(a){this.$1.spherical_photo_session_id=a;return this};a.prototype.setSurface=function(a){this.$1.surface=a;return this};a.prototype.setTotalDataLoaded=function(a){this.$1.total_data_loaded=a;return this};a.prototype.setVfov=function(a){this.$1.vfov=a;return this};a.prototype.setViewportHeight=function(a){this.$1.viewport_height=a;return this};a.prototype.setViewportWidth=function(a){this.$1.viewport_width=a;return this};a.prototype.setYaw=function(a){this.$1.yaw=a;return this};c={avg_frame_render_time:!0,avg_texture_to_screen_ratio2:!0,client_userid:!0,composer_session_id:!0,country:!0,device_pixel_ratio:!0,dt:!0,error_code:!0,error_message:!0,error_stack_trace:!0,error_type:!0,event_type:!0,fallback_ui:!0,is_gyro_enabled:!0,max_gpu_memory_used:!0,max_tile_level:!0,name:!0,number_of_spherical_photo:!0,photo_id:!0,pitch:!0,render_method:!0,spherical_photo_session_id:!0,surface:!0,total_data_loaded:!0,vfov:!0,viewport_height:!0,viewport_width:!0,yaw:!0};e.exports=a}),null);
__d("SpotlightViewerLoggingEvents",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({LOADED:"loaded",LOADING:"loading",ERROR:"error",ABORT:"abort",OPEN_BEGIN:"open_begin",OPEN_COMPLETE:"open_complete",CLOSE_BEGIN:"close_begin",CLOSE_COMPLETE:"close_complete",PAGE_BEGIN:"page_begin",PAGE_COMPLETE:"page_complete",PHOTO_CHANGE_BEGIN:"photo_change_begin",PHOTO_CHANGE_COMPLETE:"photo_change_complete",DATA_FETCH_BEGIN:"data_fetch_begin",DATA_FETCH_COMPLETE:"data_fetch_complete",PHOTO_FETCH:"photo_fetch"})}),null);
__d("PhotoLogger",["Banzai","BanzaiScuba","Event","SpotlightViewerLoggingEvents","SubscriptionsHandler"],(function(a,b,c,d,e,f){__p&&__p();function a(a){"use strict";this.$1=a,this.$2={}}a.prototype.log=function(a,c,d,e){"use strict";b("Banzai").post("profile_photos_view",{photo_fbid:c,source:d,profile_id:e}),this.$2[a]||(this.$3(a),this.$2[a]=!0)};a.prototype.$3=function(a){"use strict";this.$4(b("SpotlightViewerLoggingEvents").LOADING,{uri:a});var c=new(b("SubscriptionsHandler"))(),d=new Image();c.addSubscriptions(b("Event").listen(d,"load",function(){this.$4(b("SpotlightViewerLoggingEvents").LOADED,{uri:a}),c.release()}.bind(this)),b("Event").listen(d,"error",function(){this.$4(b("SpotlightViewerLoggingEvents").ERROR,{uri:a}),c.release()}.bind(this)),b("Event").listen(d,"abort",function(){this.$4(b("SpotlightViewerLoggingEvents").ABORT,{uri:a}),c.release()}.bind(this)));d.src=a};a.prototype.logEvent=function(a){"use strict";this.$4(a)};a.prototype.$4=function(a,c){"use strict";var d=new(b("BanzaiScuba"))("photos_client_loading",null,{addBrowserFields:!0});d.addNormal("event",a);d.addNormal("viewer",this.$1);for(var e in c)d.addNormal(e,c[e]);d.post()};e.exports=a}),null);
__d("PhotoSessionLog",["AsyncRequest","Run","URI","Vector","WWWBase"],(function(a,b,c,d,e,f){__p&&__p();function g(){}Object.assign(g,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,LOADING:8,PERMALINK:0,SNOWLIFT:6,SNOWDOWN:13,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:!1,last:!1,logIds:!1,version:null,source:null,buttonLikes:0,pagingAction:"",cycle:!1,endOfRelevant:!1,relevantCount:0,closingTypeToString:function(a){return{0:"UNKNOWN",1:"ESC",2:"X",3:"OUTSIDE",4:"UNLOAD",5:"NAVIGATE"}[a]||"UNKNOWN"},initLogging:function(a){__p&&__p();this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=!0;this.last=!1;this.logIds=!1;this.eid="";this.version=a;this.buttonLikes=0;this.pagingAction="";this.cycle=!1;this.endOfRelevant=!1;this.relevantCount=0;this.topLevelPostId=0;if(a===g.SNOWLIFT){a=b("Vector").getViewportDimensions();this.width=a.x;this.height=a.y}},_isSnowlift:function(){return this.version===g.SNOWLIFT},setLogFbids:function(a){this.logIds=a},setTopLevelPostId:function(a){this.topLevelPostId=a},setEid:function(a){this.eid=a},setPhotoSet:function(a){this.set=a},addButtonLike:function(){this.buttonLikes++},setPagingAction:function(a){this.pagingAction=a},setCycle:function(a){this.cycle=a},setEndOfRelevant:function(a){this.endOfRelevant=a},setRelevantCount:function(a){this.relevantCount=a},setEndMetrics:function(a){this.endMetrics=a},setSource:function(a){this.source=a},addPhotoView:function(a,b,c){this.logIds&&this.views>=this.AGGREGATION_COUNT&&this.logPhotoViews(this.AGGREGATE),this.views++,a&&this.fbidList.push([a.fbid,a.owner,Date.now()]),b&&this.hiResLoads++,c&&(this.fullScreenViews[a.fbid]=!0)},logEnterFullScreen:function(a){this.fullScreenViews[a]=!0},addDetailData:function(a,b){this.details[a]||(this.details[a]={t:b.num_tags,l:b.has_location,c:b.has_caption,cm:b.comment_count,lk:b.like_count,w:b.width,h:b.height,ad:"{}",p:this.pagingAction})},updateAdData:function(a,b){this.details[a]&&(this.details[a].ad=JSON.stringify(b))},logPhotoViews:function(a){__p&&__p();if(!this.views)return;a!=this.AGGREGATE&&(this.last=!0);this.logData(a?a:this.UNKNOWN);this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=!1;this.buttonLikes=0;this.last&&(this.set=null,this.logIds=!1,this.fullScreenViews={})},logInitialLoad:function(){this.logData(g.LOADING)},logData:function(a){__p&&__p();var c=[],d={},e=0;a===this.LOADING?(e=this.topLevelPostId,this.topLevelPostId||(c=this.fbidList,d=this.details)):(c=this.fbidList,d=this.details);c={set:this.set,time:new Date()-this.time,fbids:c,details:d,eid:this.eid,first:this.first,last:this.last,close:a,button_likes:this.buttonLikes,version:this.version,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source,top_level_post_id:e};if(this.version===g.SNOWLIFT){d=b("Vector").getViewportDimensions();c.width=d.x||this.width;c.height=d.y||this.height;this.hiResLoads>0&&(c.hires_loads=this.hiResLoads);if(this.last){e=Object.keys(this.fullScreenViews).length;e>0&&(c.fullscreen=e)}}d=new(b("URI"))(b("WWWBase").uri).setPath("/ajax/photos/logging/session_logging.php");new(b("AsyncRequest"))().setAllowCrossPageTransition(!0)